/***************************************
* @preserve
* ForeSee Client Code: Trigger
* http://www.answers.com/page/businesssolutions
* Built October 19, 16 14:25:42
* Code version: 19.0.35
* Template version: 19.0.35
***************************************/
("undefined"!=typeof _acsDefine?_acsDefine:define)(["require","_acs","triggerconfig","recordconfig",_acsNormalizeUrl("/trigger/fs.utils.js")],function(e,t,config,i,r){"string"==typeof t.startTS&&(t.startTS=r.now());var s={},n=function(e,t,i,s,n){var o={width:700,height:350,left:50,top:50,resizable:"no",scrollbar:"1",scrollbars:"1",toolbar:"no",menubar:"no",location:"0",directories:"no",status:"no"},a=r.ext(o,i),c="";for(var f in a)c+=f+"="+a[f]+",";var l=this._win=window.open(e,t,c);if(l&&n)if(l.blur(),l.opener.window.focus(),window.self.window.focus(),window.focus(),"Firefox"==s.browser.name){var u=window.open("about:blank");u.focus(),u.close()}else s.isIE&&setTimeout(function(){l.blur(),l.opener.window.focus(),window.self.window.focus(),window.focus()},1e3);return l},o=function(){var e=this;this.isOver=!0,r.Bind(document,"trigger:mouseout",function(t){t=t?t:window.event;var i=t.relatedTarget||t.toElement;i&&"HTML"!=i.nodeName||e.isOver&&(e.isOver=!1)},!1),r.Bind(document,"trigger:mouseover",function(t){e.isOver||(e.isOver=!0)},!1),r.Bind(document,"trigger:mousemove",function(t){e.isOver||(e.isOver=!0)})},a={INVITE_SHOWN:100,INVITE_ACCEPTED:101,INVITE_DECLINED:102,INVITE_ABANDONED:105,INVITE_PAGE_SHOWN:104,TRACKER_SHOWN:200,TRACKER_CLOSED:201,TRACKER_CLICKED:202,QUALIFIER_SHOWN:300,QUALIFIER_ACCEPTED:301,SURVEY_SHOWN:400,CANCEL_SHOWN:500,PURCHASE_EVENT:800,ITEMS_EVENT:801,DOLLARS_EVENT:802},c="survey.foreseeresults.com",f="events.foreseeresults.com",l=".4seeresults.com",u="i.4see.mobi",d={SERVICE_TYPES:{survey:{host:c,path:"/survey",url:"/display",protocol:"https"},mobileOnExitInitialize:{host:u,path:"/e",url:"/initialize"},mobileOnExitHeartbeat:{host:u,path:"/e",url:"/recordHeartbeat"},check:{host:"controller"+l,path:"/fsrSurvey",url:"/OTCImg",success:3},event:{host:f,path:"/rec",url:"/process?event=logit"},domain:{host:c,path:"/survey",url:"/FSRImg",success:3},replay:{host:"replaycontroller"+l,path:"/images",enabled:!0}}};d.log=function(e,t,config,i,s,n,o,a){var c=new Date,f=new r.ImageTransport,l=config.config,u=s.get("rid"),d=s.get("q"),h={ver:1,cid:l.id,rid:u,q:d,type:s.get("dn")||"",site:l.site_id,msg:n,tms:c.getTime(),tmz:6e4*c.getTimezoneOffset()};if(i&&(h.cat=i.name||"",h.sec=i.section||"",h.lang=i.language.locale||""),"object"==typeof t){h.param="";for(var p in t)h.param+=encodeURIComponent(p)+"="+encodeURIComponent(t[p])+"&"}else"string"==typeof t&&(h.param=t);for(var g in h)"undefined"!=typeof h[g]&&null!==h[g]||delete h[g];f.send({url:"https://"+e.host+e.path+(e.url||""),success:o||function(){},failure:a||function(){},data:h})},d.ping=function(e,t,i,s){var n=new r.ImageTransport;n.send({url:"https://"+e.host+e.path+(e.url||""),success:i||function(){},failure:s||function(){},data:t})};var h=function(i,s,n,o,a,c,f){if(this.trig=i,this.browser=s,this.stg=n,this.cpps=o,this.events=a,this.displayoverride=c,r.isDefined(this.trig.surveydef.inviteExclude)&&r.isDefined(this.trig.crit)&&this.trig.crit.runAllTests(this.trig.surveydef.inviteExclude,this.browser,!1,!0))return!1;var l=this;d.ping(d.SERVICE_TYPES.check,{protocol:"https"},function(){e([t.makeURI("foresee/fs.invite.js")],function(e){var t=l.invite=i.invite=new e(config,i.surveydef,s,n.fstg,c,o);n.set("dn",t.display.displayname),o.set("dn",t.display.displayname),f&&f.call(l)})},function(){})};h.prototype.initialize=function(){var e=this.trig,i=(this.browser,this.stg),n=this.cpps,o=this.events,c=(this.displayoverride,this.invite);c.loadResources(function(){setTimeout(function(){c.present(),o.inviteShown&&o.inviteShown(e.surveydef,i,config,n),d.log(d.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,i,a.INVITE_SHOWN)},Math.max(0,config.config.inviteDelay-(r.now()-t.startTS)))}),c.declined.subscribe(function(){i.setNewRepeatDays(config.config.repeatDays.decline),o.inviteDeclined&&o.inviteDeclined(e.surveydef,i,config,n),e.surveydef.cxRecord&&s.rec&&(s.rec.cancelRecord(),e.recordController=s.rec=null),d.log(d.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,i,a.INVITE_DECLINED),i.set("i","d")});var f=function(t,r){var s=new k(r,config,e.surveydef,n,i.get("rid"));s.init(t,function(){s.beginHeartbeat()})};c.abandoned.subscribe(function(){d.log(d.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,i,a.INVITE_ABANDONED),i.set("i","a"),i.set("rw",r.now()+config.config.reinviteDelayAfterInviteAbandon)}),c.accepted.subscribe(function(t,l){switch(i.setNewRepeatDays(config.config.repeatDays.accept),o.inviteAccepted&&o.inviteAccepted(e.surveydef,i,config,n),e.surveydef.cxRecord&&s.rec&&s.rec.recorder&&(s.rec.beginTransmitting(),n.set("replay_id",s.rec.recorder.logger.gsessionid),n.set("sessionid",s.rec.recorder.logger.sessionid)),d.log(d.SERVICE_TYPES.event,window.location.toString(),config,e.surveydef,i,a.INVITE_ACCEPTED),i.set("i","x"),i.set("ixw",r.now()),t){case"TRACKER":e.popTracker(c);break;case"INSESSION":e.popSurvey();break;case"SMS":f(l,t);break;case"EMAIL":f(l,t);break;case"SMSEMAIL":f(l,t)}})};var p=function(e){this.fstg=e,this.lasthbval=0,this.heartbeatExpired=new r.FSEvent,this.enabled=!0,this.fstg.trackerHeartbeat.subscribe(r.proxy(function(){this.enabled&&(this.lasthbval=r.now(),this._resetTimer())},this))};p.prototype._resetTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=0),this._timer=setTimeout(r.proxy(function(){this.heartbeatExpired.fire(),this.enabled=!1},this),2500)};var g=function(e,i,n,c,f,l,u,h,p){s.tracker&&(s.tracker.dispose(),s.tracker=null),s.tracker=this,this.template=e,this.def=i,this.cfg=n,this.disp=h,this.fstg=f,this.mtrk=new o,this.br=p,this.cpps=u,this._fcBindings=[],e&&this._fcBindings.push(f.trackerHeartbeat.subscribe(function(){l.trackerShown&&l.trackerShown(i,c,n,u),d.log(d.SERVICE_TYPES.event,window.location.toString(),n,i,c,a.TRACKER_SHOWN)},!0,!1));var g=r.proxy(function(){f._postMessage("trackercmd",{method:"hb",tm:r.now()})},this);this._heartbeat=setInterval(g,Math.round(n.config.trackerHeartbeatTimeout/2)),g(),r.Bind(window,"unload",r.proxy(function(){this.mtrk.isOver&&this.fstg&&this.fstg._postMessage("trackercmd",{method:"hbx",tm:r.now()})},this)),this._url=t.makeURI("foresee/fs.tracker.html?domain="+encodeURIComponent(document.domain.toString())+"&fsrlocale="+encodeURIComponent(u.get("locale")||"en")),this.fstg.isSSL&&("//"==this._url.substr(0,2)&&(this._url="https:"+this._url),this._url=this._url.replace(/http:/i,"https:")),this._sendDefinition()};g.prototype._sendDefinition=function(){var e=this,t={method:"init",cfg:this.cfg,def:this.def};this.disp&&(t.display=this.disp),this.template&&(t.template=this.template),e._fcBindings.push(e.fstg.trackerHeartbeat.subscribe(function(){e.fstg._postMessage("trackercmd",{method:"trackerinfo",data:t}),e.cpps.save()},!0,!0))},g.prototype.show=function(e){this.wref=n(this._url,"acsTracker",{width:700,height:450},e,!0)},g.prototype.applyExisting=function(e,t){this.wref=t,t.location=this._url},g.prototype.dispose=function(){for(var e=0;e<this._fcBindings.length;e++)this._fcBindings[e].unsubscribe();this.fstg=null};var v=function(config,e,t){this.cfg=config,this.cpps=e,this.def=t,this.locale=e.get("locale")||"en"};v.prototype.getUrl=function(){var e=encodeURIComponent,t=this.def,i=this.cfg.config.surveyUrl+"?",s=r.now()+"_"+Math.round(1e13*Math.random()),n=t.name+"-"+(r.isDefined(t.site)?t.site+"-":"")+(r.isDefined(t.section)?this.def.section+"-":"")+this.locale,o={sid:e(n),cid:e(this.cfg.config.id),pattern:e(this.cpps.get(t.pattern)),a:s,b:r.hash(s),c:864e5,version:this.cfg.config.version};for(var a in o)i+=encodeURIComponent(a)+"="+encodeURIComponent(o[a])+"&";return i+=this.cpps.toQueryString()};var w=function(config){this.cfg=config};w.prototype={isDomainEnabled:function(){var e,t=this.cfg.properties.analytics.google_remote;if(t){var i=options_.site.domain;t[i]&&(e=t[i])}return e},toQueryString:function(e){var t={},i=this.isDomainEnabled();return i&&(t.domain="."+options_.site.domain,t.id=i.id,t.name=i.name,e&&(t.event=e)),r.toQueryString(t,"ga")},getEvent:function(e){var t;return this.isDomainEnabled()&&gad.events&&(t=gad.events[e]),t},fireEvent:function(e){var t=this.isDomainEnabled();if(t){window._gaq=window._gaq||[];var i=this.getEvent(e);i&&window._gaq.push(["_trackEvent","foresee survey",i,t.name])}},getLinkerUrl:function(e){var t=e;if(this.isDomainEnabled()&&window._gat){var i=window._gat._getTrackerByName();t=i._getLinkerUrl(e)}return t},init:function(){if(this.isDomainEnabled()){window._gaq=window._gaq||[],window._gaq.push(["_setAccount",gad.id]),window._gaq.push(["_setDomainName","."+options_.site.domain]),window._gaq.push(["_trackPageview"]);var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}}};var m=function(e,config){this.stg=e,this.cfg=config};m.prototype.calcReplayPoolStatus=function(e){var t,i,s,n,o,a=this.cfg.config,c=a.replay_pools,f=window.location.toString();if(c&&0!==c.length&&this.pooloverride!==!0){if(i=this.stg.get("pl"),!r.isDefined(i))for(t=0;t<c.length;t++)s=new RegExp(c[t].path,"gi"),s.exec(f)&&(i=100*Math.random()<c[t].sp?1:0,this.stg.set("pl",i));if(n=a.replay_repools,0===i&&n&&n.length>0)for(t=0;t<n.length;t++)o=new RegExp(n[t].path,"gi"),o.exec(f)&&(i=100*Math.random()<n[t].sp?1:0,this.stg.set("pl",i));e(!!i)}else e(!0)},m.prototype.optoutCheck=function(e,t){this.stg.fstg.sync(r.proxy(function(i){i&&"true"==i.optout&&parseInt(i.expires,10)>r.now()?t():e()},this),this.cfg.config.site_id+"_oo")},m.prototype.browserCheck=function(e,t){return!(!e.isMobile&&t.config.browser_cutoff[e.browser.name]&&e.browser.actualVersion<t.config.browser_cutoff[e.browser.name])},m.prototype.platformCheck=function(e,t){return!(t.config.platform_cutoff[e.os.name]&&e.os.version<t.config.platform_cutoff[e.os.name])},m.prototype.checkDeviceBlacklist=function(e,t){for(var i=0;i<t.config.device_blacklist.length;i++)if(e.agent.toLowerCase().indexOf(t.config.device_blacklist[i].toLowerCase())>-1)return!1;return!0},m.prototype._match=function(e,t,i){var r=e.include,s=e[i||"globalExclude"];if(e.criteria){if(!e.criteria.supportsSmartPhones&&!t.isTablet&&t.isMobile)return!1;if(!e.criteria.supportsTablets&&t.isTablet)return!1;if(!e.criteria.supportsDesktop&&!t.isMobile)return!1}var n=window.location.href.toString(),o=document.referrer.toString();({urls:n,referrers:o,userAgents:window.navigator.userAgent});if(s){var a=this.runAllTests(s,t,!1,!0);if(a)return!1}return!r||this.runAllTests(r,t,!1,!0)},m.prototype.runAllTests=function(e,t,i,s){function n(e,t){r.isArray(t)||(t=[t]);for(var i=0,s=t.length;i<s;i++)if("string"==typeof t[i]&&(t[i]=t[i].replace(/-_DS_-/gi,"$")),(e+"").match(t[i]))return!0;return!1}var o,a=new r.Cookie({}),c=window.location.href.toString(),f=document.referrer.toString(),l={urls:c,referrers:f,userAgents:window.navigator.userAgent};for(var u in e){var d=e[u];if(d.length>0){if(o=!1,l[u])o=n(l[u],d);else if("browsers"==u)for(var h=t.browser.name,p=t.browser.actualVersion,g=0;g<d.length;g++)h.toLowerCase().indexOf(d[g].name.toLowerCase())>-1&&(d[g].comparison?"lt"==d[g].comparison&&p<d[g].version?o=!0:"eq"==d[g].comparison&&p==d[g].version?o=!0:"gt"==d[g].comparison&&p>d[g].version&&(o=!0):o=!0);else if("cookies"==u)for(var v=0;v<d.length;v++){var w=d[v],m=a.get(w.name);r.isDefined(w.value)&&m==w.value?o=!0:!r.isDefined(w.value)&&m&&(o=!0)}else if("variables"==u)for(var y=0;y<d.length;y++){var b=d[y],_=new[].constructor.constructor("var v1 = '';try { v1 = "+b.name+"}catch(err) {}return v1;"),E=_.call(window);r.isDefined(b.value)&&E==b.value?o=!0:!r.isDefined(b.value)&&E&&(o=!0)}if(!o&&i)return!0;if(o&&s)return!0}}return!1};var y=function(e){this.cfg=e};y.prototype._bindToLink=function(e,t){for(var i=document.querySelectorAll(e.selector),s=function(e,t,i){return function(s){t.preventDefault&&r.preventDefault(s),i.call(e,t)}},n=0;n<i.length;n++){var o,a=i[n],c=!0;if(e.attribute&&(o=a.getAttribute(e.attribute),c=!1,o&&(c=!0,e.patterns&&e.patterns.length>0))){c=!1;for(var f=0;f<e.patterns.length;f++)if(o.toLowerCase().indexOf(e.patterns[f].toLowerCase())>-1){c=!0;break}}c&&r.Bind(a,"trigger:click",s(this,e,t))}},y.prototype.performBindings=function(e){if(e&&this.cfg){var t,i=this.cfg;if(i.cancel&&i.cancel.length>0){var r=function(){e.cancelTracker()};for(t=0;t<i.cancel.length;t++)this._bindToLink(i.cancel[t],r)}if(i.survey&&i.survey.length>0){var s=function(){e.popSurvey()};for(t=0;t<i.survey.length;t++)this._bindToLink(i.survey[t],s)}if(i.tracker&&i.tracker.length>0){var n=function(){e.popTracker()};for(t=0;t<i.tracker.length;t++)this._bindToLink(i.tracker[t],n)}}};var b=function(e,i,n,o,a,c){var f={},l=e.FSR||{};l.CPPS;f.CPPS=o,f.clearState=function(){i.reset(),a.kill("acs.ovr")},f.config=function(){return config},f.optOut=function(){var e=window.location.toString();window.location=e.indexOf("#")?e.substr(0,e.indexOf("#")-1)+"#acscommand=fsoptout":e+"#acscommand=fsoptout",window.location.reload()},f.test=function(){var e=window.location.toString();window.location=e.indexOf("#")?e.substr(0,e.indexOf("#")-1)+"#acscommand=fstest":e+"#acscommand=fstest",window.location.reload()};var u;f.run=f.pageReset=function(){u&&(clearTimeout(u),u=null),u=setTimeout(function(){var e=s.trig;e&&(e.dispose(),s.trig=null),t.startTS=r.now(),setTimeout(function(){D()},50)},250)},f.showInvite=function(e){var t=new r.Browser;t.browserReady.subscribe(r.proxy(function(){var r=s.trig||E(i,config,t,n,o,a,c);if(r.init()&&r.surveydef){new h(r,t,i,o,c,e,function(){this.initialize()})}},this),!0,!0)},f.getCookie=function(e){return a.get(e)};var d=config.config.publicApiName||"FSR";e[d]||(e[d]={}),r.ext(e[d],f,!1)},_=function(i,n,o,a,c,f){n&&r.isDefined(window.Uint8Array)&&a&&e([t.makeURI("foresee/fs.record.js")],function(e){c.set("cxreplayaws","true"),o.set("rc","true"),s.rec=e.getInstance(i,window,o),f&&(f.recordController=rec)})},E=function(e,config,t,i,s,n,o){var c=new S(e,config,t,i,s);return c.heartbeatExpired.subscribe(r.proxy(function(){var t=n.get("acs.ta");t||(n.kill("acs.ta"),d.log(d.SERVICE_TYPES.event,window.location.toString(),config,c.surveydef,e,a.TRACKER_CLOSED))},this),!0,!1),c},S=function(e,i,s,n,o){this.stg=e,this.cfg=i,this.browser=s,this.crit=n,this.cpps=o,e.get("pv")||(o.set("terms",this.decodeReferrer()||""),o.set("browser",s.browser.name+" "+s.browser.version),o.set("os",s.os.name),o.set("flash",r.Flash.getVersion()),o.set("hosted",t.makeURI("/").indexOf("answerscloud.com")>-1),o.set("referrer",document.referrer.toString()),o.set("site",i.config.site_id),o.set("trigger_version",i.config.version)),this.trkhb=new p(e.fstg),this.heartbeatExpired=new r.FSEvent;var a=!1;e.fstg.trackerMsg.subscribe(r.proxy(function(e){e&&e.acsSurveyDisplayed&&(a=!0)},this)),this.trkhb.heartbeatExpired.subscribe(r.proxy(function(){a||this.heartbeatExpired.fire()},this),!0,!1)};S.prototype.doesPassCriteria=function(){var e=this.crit;return!!(e.platformCheck(this.browser,this.cfg)&&e.browserCheck(this.browser,this.cfg)&&e.checkDeviceBlacklist(this.browser,this.cfg))},S.prototype.popTracker=function(e){var t=this;if(this.stg.set("i","x"),this.didPopTrackerAlready="y"==this.stg.get("dt"),!this.didPopTrackerAlready){this.stg.set("dt","y");var i=function(){t.tracker=new g(e.template,t.surveydef,config,t.stg,t.stg.fstg,config.config.events,t.cpps,e.display,t.browser),t.tracker.show(t.browser)};if(e)i();else{var r=n("about:blank","acsTracker",{width:700,height:400},this.browser,!0);new h(this,t.browser,t.stg,t.cpps,config.config.events,(!1),function(){t.tracker=new g(this.invite.template,t.surveydef,config,t.stg,t.stg.fstg,config.config.events,t.cpps,this.invite.display,t.browser),t.tracker.applyExisting(t.browser,r)})}}},S.prototype.canDisplayInvitation=function(){return this.crit._match(this.cfg.config,this.browser,"inviteExclude")},S.prototype.popSurvey=function(){if(this.stg.set("i","x"),this.didPopTrackerAlready="y"==this.stg.get("dt"),this.didPopTrackerAlready)this.stg&&this.stg.fstg&&this.stg.fstg._postMessage("trackercmd",{method:"survey"});else{this.stg.set("dt","y");var e=new v(config,this.cpps,this.surveydef),t=e.getUrl();n(t,"acsSurvey",{width:700,height:400},this.browser,!0);d.log(d.SERVICE_TYPES.event,window.location.toString(),config,this.surveydef,this.stg,a.SURVEY_SHOWN)}},S.prototype.init=function(){var e,t,i,s=this.cfg.surveydefs,n=this.stg.get("def");for(e=0;e<s.length;e++)i=s[e],t&&(i=r.ext(t,i),!s[e].site&&t.site&&delete i.site,!s[e].section&&t.section&&delete i.section,s[e]=i),t=r.ext({},i);if(r.isDefined(n)&&parseInt(n)>s.length-1&&(n=void 0),r.isDefined(n)&&"default"!=s[parseInt(n)].selectMode&&"pin"!=s[parseInt(n)].selectMode){if(r.isDefined(n)||"lock"==s[parseInt(n)].selectMode)return i=s[parseInt(n)],this.cfg.active_surveydef=i,this.surveydef=i,this._setupTrueConversionIfRequired(),this.locale=this._initLocale(),this.cpps.set("locale",this.locale),i}else for(e=0;e<(r.isDefined(n)&&"default"!=s[parseInt(n)].selectMode?parseInt(n)+1:s.length);e++)if(i=s[e],r.isDefined(n)&&n==e&&"default"!=s[parseInt(n)].selectMode||this.crit._match(i,this.browser))return this.cfg.active_surveydef=i,this.surveydef=i,this._setupTrueConversionIfRequired(),this.locale=this._initLocale(),this.cpps.set("locale",this.locale),this.stg.set("def",e),i;return!1},S.prototype._initLocale=function(){var e,t=this.surveydef,i=t.language;if(r.isDefined(i.src)&&r.isDefined(i.locales)){switch(i.src){case"variable":r.isDefined(i.name)&&(e=window[i.name]);break;case"cookie":if(r.isDefined(i.name)){var s=new r.Cookie({});e=s.get(i.name)}break;case"url":var n=i.locales;if(r.isDefined(n))for(var o=0,a=n.length;o<a;o++)if(r.isDefined(n[o].locale)&&r.isDefined(n[o].match)&&location.href.match(n[o].match))return n[o].locale;if(r.isDefined(i.locale))return i.locale}if(e)for(var c=0;c<i.locales.length;c++)if(i.locales[c].match==e)return i.locale=i.locales[c].locale,i.locale}return"en"},S.prototype.cancelTracker=function(){this.stg&&this.stg.fstg&&this.stg.fstg._postMessage("trackercmd",{method:"close"})},S.prototype._setupTrueConversionIfRequired=function(){var i=(this.surveydef,this.cfg.config);i.trueconversion&&i.trueconversion.enabled&&e([t.makeURI("foresee/fs.trueconversion.js")],r.proxy(function(e){this.trueconversion=new e(this,d)},this))},S.prototype.logState=function(){this.pageViewCount=(this.stg.get("pv")||0)+1,this.stg.set("pv",this.pageViewCount)},S.prototype.logDefState=function(){this.surveydef&&(this.defPageViewCount=(this.stg.get(this.surveydef.name+"pv")||0)+1,this.stg.set(this.surveydef.name+"pv",this.defPageViewCount))},S.prototype.evalLoyaltySampling=function(){var e=this.surveydef,t=this.stg.get("pl"),i=r.isDefined(t)&&1!=t?e.criteria.sp.outreplaypool||0:e.criteria.sp.reg||0,s=100*Math.random();return this.defPageViewCount>=e.criteria.lf&&s<=i},S.prototype.decodeReferrer=function(){var e,t,i=document.referrer||"",r=null,s=["q","p","query"];for(t=0;t<s.length&&!(r=i.match(new RegExp("[?&]"+s[t]+"=([^&]*)")));t++);return r?(e=decodeURIComponent(r[1]),e&&(e=e.replace(/\+/g," ")),e):e},S.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.trueconversion&&this.trueconversion.dispose(),this.invite&&this.invite.dispose(),s.rec&&(s.rec.dispose(),s.rec=null),r.Unbind("trigger:*"))};var k=function(e,t,i,s,n){this.itype=e,this.cfg=t,this.def=i,this.cpps=s,this.rid=n,this._measureName=this.def.name+"-"+(r.isDefined(this.def.site)?this.def.site+"-":"")+(r.isDefined(this.def.section)?this.def.section+"-":"")+this.def.language.locale};k.prototype.init=function(e,t){t=t||function(){};var i=r.now()+"_"+Math.round(1e13*Math.random());d.ping(d.SERVICE_TYPES.mobileOnExitInitialize,{a:i,notify:e,b:r.hash(i),c:864e5,cid:this.cfg.config.id,sid:this._measureName,rid:this.rid,uid:r.now(),support:"SMSEMAIL"==this.itype?"b":"EMAIL"==this.itype?"e":"s",cpps:"version="+encodeURIComponent(this.cfg.config.version)+"&"+this.cpps.toQueryString()},t,t)},k.prototype.beginHeartbeat=function(){this._timer&&(clearTimeout(this._timer),this._timer=null);var e=r.proxy(function(){d.ping(d.SERVICE_TYPES.mobileOnExitHeartbeat,{cid:this.cfg.config.id,sid:this._measureName,rid:this.rid,uid:r.now()},function(){},function(){})},this);this._timer=setInterval(e,config.config.onExitMobileHeartbeatInterval),e()};var I=config.config.events,T=window!=window.top;if(I.loaded&&I.loaded(),("dontRunOtherIframes"!==config.config.workInIframes&&config.config.workInIframes||!T)&&!(window.__fsrtracker||window.location.toString().indexOf("survey.foreseeresults.com")>-1)){var D=function(){var e,i,n=r.getGlobalStore(config),o=new m(n,config),a=new r.CPPS(n),c=n.get("i"),f=new r.Cookie({path:"/",secure:!1,encode:!0});r.honorNavigationEvents=!config.config.ignoreNavigationEvents,b(window,n,o,a,f,I),setTimeout(r.proxy(function(){if(a.set("url",window.location.toString()),config.config.cpps){var t=config.config.cpps;for(var l in t){var u,d=t[l];if(r.isObject(d))switch(d.source){case"param":var p=r.getParam(d.val)||d.init||null;r.isDefined(p)&&null!==p?a.set(l,p):a.get(l)||a.set(l,"");break;case"variable":r.isDefined(window[d.val])?a.set(l,window[d.val]):a.get(l)||a.set(l,d.init||"");break;case"cookie":var v=f.get(d.val);r.isDefined(v)&&null!==v?a.set(l,v):a.get(l)||a.set(l,d.init||"");break;case"url":for(var w=0,m=d.patterns.length;w<m;w++)u=d.patterns[w].value,r.isString(location.href)&&location.href.match(d.patterns[w].regex)?a.set(l,u):a.get(l)||a.set(l,d.init||"");break;case"function":r.isFunction(d.value)&&(u=d.value.call(window),a.set(l,u))}else a.set(l,d)}}var b=n.ckie.get("acs.ovr");if(b){b=JSON.parse(b);for(var S=0;S<config.surveydefs.length;S++){var k=config.surveydefs[S].name;b.sp[k]&&(config.surveydefs[S].criteria.sp=b.sp[k]),b.lf[k]&&(config.surveydefs[S].criteria.lf=b.lf[k])}b.pooloverride===!0&&(o.pooloverride=!0)}if("a"==c){var D=parseInt(n.get("rw"));D<r.now()&&(n.erase("i"),n.erase("rw"),c=null)}var C=new r.Browser;C.browserReady.subscribe(function(){if("runRecordOnly"===config.config.workInIframes&&T){for(var t=!1,l=0;l<config.surveydefs.length;l++){var u=config.surveydefs[l].cxRecord;if(u){t=!0;break}}return void _(C,t,n,!0,a)}if("d"!=c&&"a"!=c)o.calcReplayPoolStatus(function(t){return!!t&&void o.optoutCheck(r.proxy(function(){if(o._match(config.config,C,"globalExclude")&&"y"!=n.get("gx")){var r=s.trig=E(n,config,C,o,a,f,I);if(r.logState(),a.set("pv",r.pageViewCount),r.init()&&(I.initialized&&I.initialized(a),r.doesPassCriteria()&&r.surveydef)){if(r.logDefState(),_(C,r.surveydef.cxRecord,n,t,a),"x"!=c){if(r.evalLoyaltySampling()&&r.canDisplayInvitation()){new h(r,C,n,a,I,(!1),function(){this.initialize()})}}else e=new g(null,r.surveydef,config,n,n.fstg,I,a,null,C);r.surveydef.links&&(i=new y(r.surveydef.links),i.performBindings(r))}}else n.setSession("gx","y")},this),function(){})});else if("a"==c){var d="true"==n.get("rc")||n.get("rc")===!0;_(C,d,n,d,a)}},!0,!0)},this),Math.max(0,config.config.triggerDelay-(r.now()-t.startTS)))};t.domReady(D),r.pageNavEvent.subscribe(function(){var e=window,t=e[config.config.publicApiName||"FSR"];t&&acsReady(function(){t.pageReset()})},!1,!1)}});